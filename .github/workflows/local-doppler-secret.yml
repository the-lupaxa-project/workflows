name: Test Doppler Reusable Consumer

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  load-secret:
    uses: ./.github/workflows/reusable-doppler-secrets.yml
    with:
      secret_key: "TEST_SECRET"     # the key this consumer wants
    secrets:
      DOPPLER_TOKEN: ${{ secrets.DOPPLER_TOKEN }}

  check-and-print:
    needs: load-secret
    runs-on: ubuntu-latest
    steps:
      - name: Print secret or not-found message
        run: |
          SECRET_VALUE="${{ needs.load-secret.outputs.secret_value }}"
          if [ -z "$SECRET_VALUE" ]; then
            echo "❌ Secret 'MY_SECRET' not found in Doppler for project/config."
          else
            echo "✅ Secret 'MY_SECRET' from Doppler is: $SECRET_VALUE"
          fi
