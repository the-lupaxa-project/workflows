# File: .github/workflows/trufflehog.yml
name: Reusable Secrets scan (TruffleHog)

on:
  workflow_call:
    inputs:
      results:
        description: "Result types to report (verified, unknown, unverified)"
        required: false
        default: "verified,unknown"
        type: string
      fail_on_secrets:
        description: "Fail the job if any secrets are found"
        required: false
        default: true
        type: boolean
      extra_args:
        description: "Additional TruffleHog arguments (optional)"
        required: false
        default: ""
        type: string

permissions:
  contents: read
  pull-requests: read

jobs:
  trufflehog:
    name: TruffleHog secrets scan
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3  # v6.0.0
        with:
          # Fetch full history so TruffleHog can see all relevant commits
          fetch-depth: 0

      - name: Run TruffleHog
        uses: trufflesecurity/trufflehog@aade3bff5594fe8808578dd4db3dfeae9bf2abdc  # v3.91.1
        with:
          # Only scan changes relevant to the event (push/PR).
          # --fail makes the step exit with code 183 if secrets are found.
          extra_args: >-
            --results=${{ inputs.results }}
            ${{ inputs.fail_on_secrets && '--fail' || '' }}
            ${{ inputs.extra_args }}
