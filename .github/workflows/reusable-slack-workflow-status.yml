name: Reusable Slack Workflow Status

on:
  workflow_call:
    inputs:
      include_jobs:
        description: >
          Controls whether job details are included in the Slack notification.
          Valid values:
            - "true"
            - "false"
            - "on-failure"
        required: false
        type: string
        default: "true"

      include_commit_message:
        description: "Include the commit message in the notification."
        required: false
        type: boolean
        default: true

      notify_on_results:
        description: >
          Comma-separated list of results that should trigger a Slack
          notification, or "all" to notify on every result.
        required: false
        type: string
        default: "all"

    secrets:
      slack_webhook_url:
        description: "Incoming Slack webhook URL."
        required: true

permissions:
  actions: read
  contents: read

jobs:
  slack-workflow-status:
    name: Slack Workflow Status
    runs-on: ubuntu-latest

    # Only run when secrets are available (skip external PRs)
    if: >
      always() &&
      (
        github.event_name != 'pull_request' ||
        github.event.pull_request.head.repo.full_name == github.repository
      )

    env:
      # Passed directly to send-to-slack.py
      SLACK_WEBHOOK_URL: ${{ secrets.slack_webhook_url }}
      SEND_TO_SLACK_RESULTS: ${{ inputs.notify_on_results }}
      SEND_TO_SLACK_INCLUDE_JOBS: ${{ inputs.include_jobs }}
      SEND_TO_SLACK_INCLUDE_COMMIT_MESSAGE: ${{ inputs.include_commit_message }}

    steps:
      - name: Checkout workflows repo
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3
        with:
          repository: the-lupaxa-project/workflows
          path: lupaxa-dotgithub

      - name: Send Slack workflow status
        env:
          GITHUB_TOKEN: ${{ github.token }}
        run: |
          python lupaxa-dotgithub/.github/scripts/send-to-slack.py
